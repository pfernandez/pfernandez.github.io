import{T as a,j as o,I as h,J as c,K as u,N as n,e as f}from"./index-qNrukWGA.js";class r extends a{get texParser(){return this.configuration.packageData.get("textmacros").texParser}get tags(){return this.texParser.tags}constructor(t,s,e,i){super(t,s,e),this.level=i}mml(){return this.copyLists(),this.configuration.popParser(),this.level!=null?this.create("node","mstyle",this.nodes,{displaystyle:!1,scriptlevel:this.level}):this.nodes.length===1?this.nodes[0]:this.create("node","mrow",this.nodes)}copyLists(){const t=this.texParser.configuration;for(const[s,e]of Object.entries(this.configuration.nodeLists))for(const i of e)t.addNode(s,i);this.configuration.nodeLists={}}Parse(){this.text="",this.nodes=[],this.envStack=[],super.Parse()}saveText(){if(this.text){const t=this.stack.env.mathvariant,s=o.internalText(this,this.text,t?{mathvariant:t}:{});this.text="",this.Push(s)}}Push(t){if(this.text&&this.saveText(),t instanceof h)return super.Push(t);if(t instanceof c){this.stack.env.mathcolor=this.stack.env.color;return}t instanceof u&&(this.addAttributes(t),this.nodes.push(t))}PushMath(t){const s=this.stack.env;for(const e of["mathsize","mathcolor"])s[e]&&!t.attributes.hasExplicit(e)&&(!t.isToken&&!t.isKind("mstyle")&&(t=this.create("node","mstyle",[t])),n.setAttribute(t,e,s[e]));t.isInferred&&(t=this.create("node","mrow",t.childNodes)),t.isKind("TeXAtom")||(t=this.create("node","TeXAtom",[t])),this.nodes.push(t)}addAttributes(t){const s=this.stack.env;if(t.isToken)for(const e of["mathsize","mathcolor","mathvariant"])s[e]&&!t.attributes.hasExplicit(e)&&n.setAttribute(t,e,s[e])}ParseTextArg(t,s){const e=this.GetArgument(t);return s=Object.assign(Object.assign({},this.stack.env),s),new r(e,s,this.configuration).mml()}ParseArg(t){return new r(this.GetArgument(t),this.stack.env,this.configuration).mml()}Error(t,s,...e){throw new f(t,s,...e)}}export{r as T};
