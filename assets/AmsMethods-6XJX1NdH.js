import{U as h,c as w,N as d,T as C,B as m,e as A,j as y,P as E,h as S,w as x}from"./index-qNrukWGA.js";import{b as v}from"./NewcommandUtil-D3UYa-Vw.js";function b(t){if(!t||t.isInferred&&t.childNodes.length===0)return[null,null];if(t.isKind("msubsup")&&N(t))return[t,null];const e=d.getChildAt(t,0);return t.isInferred&&e&&N(e)?(t.childNodes.splice(0,1),[e,t]):[null,t]}function N(t){const e=t.childNodes[0];return e&&e.isKind("mi")&&e.getText()===""}const P={AmsEqnArray(t,e,n,i,o,s,c,a){const l=t.GetBrackets("\\begin{"+e.getName()+"}"),u=m.EqnArray(t,e,n,i,o,s,c,a);return y.setArrayAlign(u,l,t)},AlignAt(t,e,n,i){const o=e.getName();let s,c="",a="";const l=[];i||(s=t.GetBrackets("\\begin{"+o+"}"));const u=t.GetArgument("\\begin{"+o+"}");if(u.match(/[^0-9]/))throw new A("PositiveIntegerArg","Argument to %1 must be a positive integer","\\begin{"+o+"}");let r=parseInt(u,10);for(;r>0;)c+="rl",a+="bt",l.push("0em 0em"),r--;const g=l.join(" ");if(i)return P.EqnArray(t,e,n,i,c,a,g);const f=P.EqnArray(t,e,n,i,c,a,g);return y.setArrayAlign(f,s,t)},Multline(t,e,n){y.checkEqnEnv(t),t.Push(e);const i=t.options.ams.multlineIndent,o=t.itemFactory.create("multline",n,t.stack);return o.arraydef={displaystyle:!0,rowspacing:".5em",columnspacing:"100%",width:t.options.ams.multlineWidth,side:t.options.tagSide,minlabelspacing:t.options.tagIndent,"data-array-padding":`${i} ${i}`,"data-width-includes-label":!0},o},XalignAt(t,e,n,i){const o=t.GetArgument("\\begin{"+e.getName()+"}");if(o.match(/[^0-9]/))throw new A("PositiveIntegerArg","Argument to %1 must be a positive integer","\\begin{"+e.getName()+"}");const s=i?"crl":"rlc",c=i?"mbt":"btm",a=i?"fit auto auto":"auto auto fit",l=P.FlalignArray(t,e,n,i,!1,s,c,a,!0);return l.setProperty("xalignat",2*parseInt(o)),l},FlalignArray(t,e,n,i,o,s,c,a,l=!1){y.checkEqnEnv(t),t.Push(e),s=s.split("").join(" ").replace(/r/g,"right").replace(/l/g,"left").replace(/c/g,"center"),c=x(c);const u=t.itemFactory.create("flalign",e.getName(),n,i,o,t.stack);return u.arraydef={width:"100%",displaystyle:!0,columnalign:s,columnspacing:"0em",columnwidth:a,rowspacing:"3pt","data-break-align":c,side:t.options.tagSide,minlabelspacing:l?"0":t.options.tagIndent,"data-width-includes-label":!0},u.setProperty("zeroWidthLabel",l),u},HandleDeclareOp(t,e){const n=t.GetStar()?"*":"",i=v.GetCsNameArgument(t,e),o=t.GetArgument(e);v.addMacro(t,i,P.Macro,[`\\operatorname${n}{${o}}`]),t.Push(t.itemFactory.create("null"))},HandleOperatorName(t,e){const n=t.GetStar(),i=h.trimSpaces(t.GetArgument(e));let o=new C(i,Object.assign(Object.assign({},t.stack.env),{font:S.Variant.NORMAL,multiLetterIdentifiers:t.options.ams.operatornamePattern,operatorLetters:!0,noAutoOP:!0}),t.configuration).mml();if(o.isKind("mi")?o.removeProperty("autoOP"):o=t.create("node","TeXAtom",[o]),d.setProperties(o,{movesupsub:n,movablelimits:!0,texClass:w.OP}),!n){const s=t.GetNext(),c=t.i;s==="\\"&&++t.i&&t.GetCS()!=="limits"&&(t.i=c)}t.Push(t.itemFactory.create("fn",o))},SideSet(t,e){const[n,i]=b(t.ParseArg(e)),[o,s]=b(t.ParseArg(e)),c=t.ParseArg(e);let a=c;n&&(i?n.replaceChild(t.create("node","mphantom",[t.create("node","mpadded",[y.copyNode(c,t)],{width:0})]),d.getChildAt(n,0)):(a=t.create("node","mmultiscripts",[c]),o&&d.appendChildren(a,[d.getChildAt(o,1)||t.create("node","none"),d.getChildAt(o,2)||t.create("node","none")]),d.setProperty(a,"scriptalign","left"),d.appendChildren(a,[t.create("node","mprescripts"),d.getChildAt(n,1)||t.create("node","none"),d.getChildAt(n,2)||t.create("node","none")]))),o&&a===c&&(o.replaceChild(c,d.getChildAt(o,0)),a=o);const l=t.create("node","TeXAtom",[],{texClass:w.OP,movesupsub:!0,movablelimits:!0});i&&(n&&l.appendChild(n),l.appendChild(i)),l.appendChild(a),s&&l.appendChild(s),t.Push(l)},operatorLetter(t,e){return t.stack.env.operatorLetters?E.variable(t,e):!1},MultiIntegral(t,e,n){let i=t.GetNext();if(i==="\\"){const o=t.i;i=t.GetArgument(e),t.i=o,i==="\\limits"&&(n="\\!\\!\\mathop{\\,\\,"+n+"}")}t.string=n+" "+t.string.slice(t.i),t.i=0},xArrow(t,e,n,i,o,s=0){const c={width:"+"+h.em((i+o)/18),lspace:h.em(i/18)},a=t.GetBrackets(e),l=t.ParseArg(e),u=t.create("node","mspace",[],{depth:".2em"});let r=t.create("token","mo",{stretchy:!0,texClass:w.ORD},String.fromCodePoint(n));s&&r.attributes.set("minsize",h.em(s)),r=t.create("node","mstyle",[r],{scriptlevel:0});const g=t.create("node","munderover",[r]);let f=t.create("node","mpadded",[l,u],c);if(d.setAttribute(f,"voffset","-.2em"),d.setAttribute(f,"height","-.2em"),d.setChild(g,g.over,f),a){const G=new C(a,t.stack.env,t.configuration).mml(),T=t.create("node","mspace",[],{height:".75em"});f=t.create("node","mpadded",[G,T],c),d.setAttribute(f,"voffset",".15em"),d.setAttribute(f,"depth","-.15em"),d.setChild(g,g.under,f)}d.setProperty(g,"subsupOK",!0),t.Push(t.create("node","TeXAtom",[t.create("node","TeXAtom",[],{texClass:w.NONE}),g],{texClass:w.REL}))},HandleShove(t,e,n){const i=t.stack.Top();if(i.kind!=="multline")throw new A("CommandOnlyAllowedInEnv","%1 only allowed in %2 environment",t.currentCS,"multline");if(i.Size())throw new A("CommandAtTheBeginingOfLine","%1 must come at the beginning of the line",t.currentCS);i.setProperty("shove",n)},CFrac(t,e){let n=h.trimSpaces(t.GetBrackets(e,""));const i=t.GetArgument(e),o=t.GetArgument(e),s={l:S.Align.LEFT,r:S.Align.RIGHT,"":""},c=new C("\\strut\\textstyle{"+i+"}",t.stack.env,t.configuration).mml(),a=new C("\\strut\\textstyle{"+o+"}",t.stack.env,t.configuration).mml(),l=t.create("node","mfrac",[c,a]);if(n=s[n],n==null)throw new A("IllegalAlign","Illegal alignment specified in %1",t.currentCS);n&&d.setProperties(l,{numalign:n,denomalign:n}),t.Push(l)},Genfrac(t,e,n,i,o,s){n==null&&(n=t.GetDelimiterArg(e)),i==null&&(i=t.GetDelimiterArg(e)),o==null&&(o=t.GetArgument(e)),s==null&&(s=h.trimSpaces(t.GetArgument(e)));const c=t.ParseArg(e),a=t.ParseArg(e);let l=t.create("node","mfrac",[c,a]);if(o!==""&&d.setAttribute(l,"linethickness",o),(n||i)&&(d.setProperty(l,"withDelims",!0),l=y.fixedFence(t.configuration,n,l,i)),s!==""){const u=parseInt(s,10),r=["D","T","S","SS"][u];if(r==null)throw new A("BadMathStyleFor","Bad math style for %1",t.currentCS);l=t.create("node","mstyle",[l]),r==="D"?d.setProperties(l,{displaystyle:!0,scriptlevel:0}):d.setProperties(l,{displaystyle:!1,scriptlevel:u-1})}t.Push(l)},HandleTag(t,e){if(!t.tags.currentTag.taggable&&t.tags.env)throw new A("CommandNotAllowedInEnv","%1 not allowed in %2 environment",t.currentCS,t.tags.env);if(t.tags.currentTag.tag)throw new A("MultipleCommand","Multiple %1",t.currentCS);const n=t.GetStar(),i=h.trimSpaces(t.GetArgument(e));t.tags.tag(i,n),t.Push(t.itemFactory.create("null"))},HandleNoTag:m.HandleNoTag,HandleRef:m.HandleRef,Macro:m.Macro,Accent:m.Accent,Tilde:m.Tilde,Array:m.Array,Spacer:m.Spacer,NamedOp:m.NamedOp,EqnArray:m.EqnArray,Equation:m.Equation};export{P as A};
