import{H as d,x as f,q as g,y as r,e as a,U as s}from"./index-qNrukWGA.js";var u;(function(t){t.NEW_DELIMITER="new-Delimiter",t.NEW_COMMAND="new-Command",t.NEW_ENVIRONMENT="new-Environment"})(u||(u={}));const w=-100,h={GetCSname(t,e){if(t.GetNext()!=="\\")throw new a("MissingCS","%1 must be followed by a control sequence",e);const n=s.trimSpaces(t.GetArgument(e)).substring(1);return this.checkProtectedMacros(t,n),n},GetCsNameArgument(t,e){let i=s.trimSpaces(t.GetArgument(e));if(i.charAt(0)==="\\"&&(i=i.substring(1)),!i.match(/^(.|[a-z]+)$/i))throw new a("IllegalControlSequenceName","Illegal control sequence name for %1",e);return this.checkProtectedMacros(t,i),i},GetArgCount(t,e){let i=t.GetBrackets(e);if(i&&(i=s.trimSpaces(i),!i.match(/^[0-9]+$/)))throw new a("IllegalParamNumber","Illegal number of parameters specified in %1",e);return i},GetTemplate(t,e,i){let n=t.GetNext();const l=[];let o=0,c=t.i;for(;t.i<t.string.length;){if(n=t.GetNext(),n==="#"){if(c!==t.i&&(l[o]=t.string.substring(c,t.i)),n=t.string.charAt(++t.i),!n.match(/^[1-9]$/))throw new a("CantUseHash2","Illegal use of # in template for %1",i);if(parseInt(n)!==++o)throw new a("SequentialParam","Parameters for %1 must be numbered sequentially",i);c=t.i+1}else if(n==="{")return c!==t.i&&(l[o]=t.string.substring(c,t.i)),l.length>0?[o.toString()].concat(l):o;t.i++}throw new a("MissingReplacementString","Missing replacement string for definition of %1",e)},GetParameter(t,e,i){if(i==null)return t.GetArgument(e);let n=t.i,l=0,o=!1;for(;t.i<t.string.length;){const c=t.string.charAt(t.i);if(c==="{")o=t.i===n,t.GetArgument(e),l=t.i-n;else{if(this.MatchParam(t,i))return o&&(n++,l-=2),t.string.substring(n,n+l);if(c==="\\"){t.i++,l++,o=!1;const m=t.string.substring(t.i).match(/[a-z]+|./i);m&&(t.i+=m[0].length,l=t.i-n)}else t.i++,l++,o=!1}}throw new a("RunawayArgument","Runaway argument for %1?",e)},MatchParam(t,e){return t.string.substring(t.i,t.i+e.length)!==e||e.match(/\\[a-z]+$/i)&&t.string.charAt(t.i+e.length).match(/[a-z]/i)?0:(t.i+=e.length,1)},checkGlobal(t,e,i){return t.stack.env.isGlobal?t.configuration.packageData.get("begingroup").stack.checkGlobal(e,i):i.map(n=>t.configuration.handlers.retrieve(n))},checkProtectedMacros(t,e){var i;if(!((i=t.options.protectedMacros)===null||i===void 0)&&i.includes(e))throw new a("ProtectedMacro","The control sequence %1 can't be redefined",`\\${e}`)},addDelimiter(t,e,i,n){const l=e.substring(1);this.checkProtectedMacros(t,l);const[o,c]=h.checkGlobal(t,[l,e],[u.NEW_COMMAND,u.NEW_DELIMITER]);l!==e&&o.remove(l),c.add(e,new f(e,i,n)),delete t.stack.env.isGlobal},addMacro(t,e,i,n,l=""){this.checkProtectedMacros(t,e);const o=h.checkGlobal(t,[e],[u.NEW_COMMAND])[0];this.undefineDelimiter(t,"\\"+e),o.add(e,new g(l||e,i,n)),delete t.stack.env.isGlobal},addEnvironment(t,e,i,n){h.checkGlobal(t,[e],[u.NEW_ENVIRONMENT])[0].add(e,new g(e,i,n)),delete t.stack.env.isGlobal},undefineMacro(t,e){const i=h.checkGlobal(t,[e],[u.NEW_COMMAND])[0];i.remove(e),t.configuration.handlers.get(d.MACRO).applicable(e)&&(i.add(e,new g(e,()=>r.FALLBACK,[])),this.undefineDelimiter(t,"\\"+e)),delete t.stack.env.isGlobal},undefineDelimiter(t,e){const i=h.checkGlobal(t,[e],[u.NEW_DELIMITER])[0];i.remove(e),t.configuration.handlers.get(d.DELIMITER).applicable(e)&&i.add(e,new f(e,null,{})),delete t.stack.env.isGlobal}};export{w as N,u as a,h as b};
