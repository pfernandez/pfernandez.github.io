import{N as w,U as N,i as M,S as V,e as p,j as G,T as S,b as $,E as X,P as W,C as Y,a as I,H as F}from"./index-qNrukWGA.js";import"./index-DkSxGWYw.js";let C=null,A=null;const P=function(e){A.root=e;const{w:t}=C.outputJax.getBBox(A,C);return t},k=function(e){let t=0;for(;e&&!w.isType(e,"mtable");){if(w.isType(e,"text"))return null;if(w.isType(e,"mrow")){e=e.childNodes[0],t=0;continue}e=e.parent.childNodes[t],t++}return e},D=function(e,t){return e.childNodes[t==="up"?1:0].childNodes[0].childNodes[0].childNodes[0].childNodes[0]},Q=function(e,t){return e.childNodes[t].childNodes[0].childNodes[0]},z=function(e){return Q(e,0)},Z=function(e){return Q(e,e.childNodes.length-1)},H=function(e,t){return e.childNodes[t==="up"?0:1].childNodes[0].childNodes[0].childNodes[0]},ee=function(e){for(;e&&!w.isType(e,"mtd");)e=e.parent;return e},te=function(e){return e.parent.childNodes[e.parent.childNodes.indexOf(e)+1]},K=function(e){for(;e&&d(e,"inference")==null;)e=e.parent;return e},R=function(e,t,n=!1){let o=0;if(e===t)return o;if(e!==t.parent){const i=e.childNodes,l=n?i.length-1:0;w.isType(i[l],"mspace")&&(o+=P(i[l])),e=t.parent}if(e===t)return o;const r=e.childNodes,s=n?r.length-1:0;return r[s]!==t&&(o+=P(r[s])),o},E=function(e,t=!1){const n=k(e),o=H(n,d(n,"inferenceRule")),r=R(e,n,t),s=P(n),i=P(o);return r+(s-i)/2},b=function(e,t,n,o=!1){if(n===0)return;if(d(t,"inferenceRule")||d(t,"labelledRule")){const i=e.nodeFactory.create("node","mrow");t.parent.replaceChild(i,t),i.setChildren([t]),oe(t,i),t=i}const r=o?t.childNodes.length-1:0;let s=t.childNodes[r];if(w.isType(s,"mspace")){w.setAttribute(s,"width",N.em(N.dimen2em(w.getAttribute(s,"width"))+n));return}if(s=e.nodeFactory.create("node","mspace",[],{width:N.em(n)}),o){t.appendChild(s);return}s.parent=t,t.childNodes.unshift(s)},oe=function(e,t){["inference","proof","labelledRule"].forEach(o=>{const r=d(e,o);r!=null&&(m(t,o,r),J(e,o))})},ne=function(e){const t=e.nodeLists.sequent;if(t)for(let n=t.length-1,o;o=t[n];n--){if(d(o,"sequentProcessed")){J(o,"sequentProcessed");continue}const r=[];let s=K(o);if(d(s,"inference")===1){for(r.push(o);d(s,"inference")===1;){s=k(s);const i=z(D(s,d(s,"inferenceRule"))),l=d(i,"inferenceRule")?H(i,d(i,"inferenceRule")):i;d(l,"sequent")&&(o=l.childNodes[0],r.push(o),m(o,"sequentProcessed",!0)),s=i}re(e,r)}}},q=function(e,t,n,o,r){const s=e.nodeFactory.create("node","mspace",[],{width:N.em(r)});if(o==="left"){const i=t.childNodes[n].childNodes[0];s.parent=i,i.childNodes.unshift(s)}else t.childNodes[n].appendChild(s);m(t.parent,"sequentAdjust_"+o,r)},re=function(e,t){let n=t.pop();for(;t.length;){const o=t.pop(),[r,s]=ie(n,o);d(n.parent,"axiom")&&(q(e,r<0?n:o,0,"left",Math.abs(r)),q(e,s<0?n:o,2,"right",Math.abs(s))),n=o}},ie=function(e,t){const n=P(e.childNodes[2]),o=P(t.childNodes[2]),r=P(e.childNodes[0]),s=P(t.childNodes[0]),i=r-s,l=n-o;return[i,l]},se=function(e){A=new e.document.options.MathItem("",null,e.math.display);const t=e.data;ne(t);const n=t.nodeLists.inference||[];let o=0;for(const r of n){const s=d(r,"proof"),i=k(r),l=D(i,d(i,"inferenceRule")),h=z(l);let a=0;if(d(h,"inference")){const T=E(h);if(T){b(t,h,-T);const v=R(r,i,!1);b(t,r,T-v),a=T-v}}const u=Z(l);if(d(u,"inference")==null)continue;const f=E(u,!0);b(t,u,-f,!0);const y=R(r,i,!0),g=(P(i)-P(l.parent))/2;b(t,r,g<a?-g:-a),o=Math.max(0,Math.max(0,o+f-y)-g);let x;if(s||!(x=ee(r))){b(t,d(r,"proof")?r:r.parent,o,!0);continue}const B=te(x);if(B){const T=t.nodeFactory.create("node","mspace",[],{width:N.em(o)});B.appendChild(T),o=0;continue}K(x)}},L="bspr_",ce=RegExp("^"+L),m=function(e,t,n){w.setProperty(e,L+t,n)},d=function(e,t){return w.getProperty(e,L+t)},J=function(e,t){e.removeProperty(L+t)},le=function(e){e.data.root.walkTree((t,n)=>{const o=[];t.getPropertyNames().forEach(r=>{r.match(ce)&&o.push(r+":"+t.getProperty(r))}),o.length&&w.setAttribute(t,"semantics",o.join(";"))})},ae=function(e){if(C=e.document,!("getBBox"in C.outputJax))throw Error("The bussproofs extension requires an output jax with a getBBox() method")},de=function(e){C=null};class j extends M{constructor(){super(...arguments),this.leftLabel=null,this.rigthLabel=null,this.innerStack=new V(this.factory,{},!0)}get kind(){return"proofTree"}checkItem(t){if(t.isKind("end")&&t.getName()==="prooftree"){const n=this.toMml();return m(n,"proof",!0),[[this.factory.create("mml",n),t],!0]}if(t.isKind("stop"))throw new p("EnvMissingEnd","Missing \\end{%1}",this.getName());return this.innerStack.Push(t),M.fail}toMml(){const t=super.toMml(),n=this.innerStack.Top();if(n.isKind("start")&&!n.Size())return t;this.innerStack.Push(this.factory.create("stop"));const o=this.innerStack.Top().toMml();return this.create("node","mrow",[o,t],{})}}function U(e,t){const n=G.internalMath(e,N.trimSpaces(t),0);if(!n[0].childNodes[0].childNodes.length)return e.create("node","mrow",[]);const o=e.create("node","mspace",[],{width:".5ex"}),r=e.create("node","mspace",[],{width:".5ex"});return e.create("node","mrow",[o,...n,r])}function _(e,t,n,o,r,s,i){const l=e.create("node","mtr",[e.create("node","mtd",[t],{})],{}),h=e.create("node","mtr",[e.create("node","mtd",n,{})],{});let a=e.create("node","mtable",i?[h,l]:[l,h],{align:"top 2",rowlines:s,framespacing:"0 0"});m(a,"inferenceRule",i?"up":"down");let u,f;o&&(u=e.create("node","mpadded",[o],{height:".25em",depth:"+.25em",width:"+.5ex",voffset:"-.25em"}),m(u,"prooflabel","left")),r&&(f=e.create("node","mpadded",[r],{height:"-.25em",depth:"+.25em",width:"+.5ex",voffset:"-.25em",lspace:".5ex"}),m(f,"prooflabel","right"));let y,g;if(o&&r)y=[u,a,f],g="both";else if(o)y=[u,a],g="left";else if(r)y=[a,f],g="right";else return a;return a=e.create("node","mrow",y),m(a,"labelledRule",g),a}function O(e,t){if(e.GetNext()!=="$")throw new p("IllegalUseOfCommand","Use of %1 does not match its definition.",t);e.i++;const o=e.GetUpTo(t,"$");if(!o.includes("\\fCenter"))throw new p("MissingProofCommand","Missing %1 in %2.","\\fCenter",t);const[r,s]=o.split("\\fCenter"),i=new S(r,e.stack.env,e.configuration).mml(),l=new S(s,e.stack.env,e.configuration).mml(),h=new S("\\fCenter",e.stack.env,e.configuration).mml(),a=e.create("node","mtd",[i],{}),u=e.create("node","mtd",[h],{}),f=e.create("node","mtd",[l],{}),y=e.create("node","mtr",[a,u,f],{}),g=e.create("node","mtable",[y],{columnspacing:".5ex",columnalign:"center 2"});return m(g,"sequent",!0),e.configuration.addNode("sequent",y),g}const c={Prooftree(e,t){return e.Push(t),e.itemFactory.create("proofTree").setProperties({name:t.getName(),line:"solid",currentLine:"solid",rootAtTop:!1})},Axiom(e,t){const n=e.stack.Top();if(n.kind!=="proofTree")throw new p("IllegalProofCommand","Proof commands only allowed in prooftree environment.");const o=U(e,e.GetArgument(t));m(o,"axiom",!0),n.Push(o)},Inference(e,t,n){const o=e.stack.Top();if(o.kind!=="proofTree")throw new p("IllegalProofCommand","Proof commands only allowed in prooftree environment.");if(o.Size()<n)throw new p("BadProofTree","Proof tree badly specified.");const r=o.getProperty("rootAtTop"),s=n===1&&!o.Peek()[0].childNodes.length?0:n,i=[];do i.length&&i.unshift(e.create("node","mtd",[],{})),i.unshift(e.create("node","mtd",[o.Pop()],{rowalign:r?"top":"bottom"})),n--;while(n>0);const l=e.create("node","mtr",i,{}),h=e.create("node","mtable",[l],{framespacing:"0 0"}),a=U(e,e.GetArgument(t)),u=o.getProperty("currentLine");u!==o.getProperty("line")&&o.setProperty("currentLine",o.getProperty("line"));const f=_(e,h,[a],o.getProperty("left"),o.getProperty("right"),u,r);o.setProperty("left",null),o.setProperty("right",null),m(f,"inference",s),e.configuration.addNode("inference",f),o.Push(f)},Label(e,t,n){const o=e.stack.Top();if(o.kind!=="proofTree")throw new p("IllegalProofCommand","Proof commands only allowed in prooftree environment.");const r=G.internalMath(e,e.GetArgument(t),0),s=r.length>1?e.create("node","mrow",r,{}):r[0];o.setProperty(n,s)},SetLine(e,t,n,o){const r=e.stack.Top();if(r.kind!=="proofTree")throw new p("IllegalProofCommand","Proof commands only allowed in prooftree environment.");r.setProperty("currentLine",n),o&&r.setProperty("line",n)},RootAtTop(e,t,n){const o=e.stack.Top();if(o.kind!=="proofTree")throw new p("IllegalProofCommand","Proof commands only allowed in prooftree environment.");o.setProperty("rootAtTop",n)},AxiomF(e,t){const n=e.stack.Top();if(n.kind!=="proofTree")throw new p("IllegalProofCommand","Proof commands only allowed in prooftree environment.");const o=O(e,t);m(o,"axiom",!0),n.Push(o)},FCenter(e,t){},InferenceF(e,t,n){const o=e.stack.Top();if(o.kind!=="proofTree")throw new p("IllegalProofCommand","Proof commands only allowed in prooftree environment.");if(o.Size()<n)throw new p("BadProofTree","Proof tree badly specified.");const r=o.getProperty("rootAtTop"),s=n===1&&!o.Peek()[0].childNodes.length?0:n,i=[];do i.length&&i.unshift(e.create("node","mtd",[],{})),i.unshift(e.create("node","mtd",[o.Pop()],{rowalign:r?"top":"bottom"})),n--;while(n>0);const l=e.create("node","mtr",i,{}),h=e.create("node","mtable",[l],{framespacing:"0 0"}),a=O(e,t),u=o.getProperty("currentLine");u!==o.getProperty("line")&&o.setProperty("currentLine",o.getProperty("line"));const f=_(e,h,[a],o.getProperty("left"),o.getProperty("right"),u,r);o.setProperty("left",null),o.setProperty("right",null),m(f,"inference",s),e.configuration.addNode("inference",f),o.Push(f)}};new $("Bussproofs-macros",{AxiomC:c.Axiom,UnaryInfC:[c.Inference,1],BinaryInfC:[c.Inference,2],TrinaryInfC:[c.Inference,3],QuaternaryInfC:[c.Inference,4],QuinaryInfC:[c.Inference,5],RightLabel:[c.Label,"right"],LeftLabel:[c.Label,"left"],AXC:c.Axiom,UIC:[c.Inference,1],BIC:[c.Inference,2],TIC:[c.Inference,3],RL:[c.Label,"right"],LL:[c.Label,"left"],noLine:[c.SetLine,"none",!1],singleLine:[c.SetLine,"solid",!1],solidLine:[c.SetLine,"solid",!1],dashedLine:[c.SetLine,"dashed",!1],alwaysNoLine:[c.SetLine,"none",!0],alwaysSingleLine:[c.SetLine,"solid",!0],alwaysSolidLine:[c.SetLine,"solid",!0],alwaysDashedLine:[c.SetLine,"dashed",!0],rootAtTop:[c.RootAtTop,!0],alwaysRootAtTop:[c.RootAtTop,!0],rootAtBottom:[c.RootAtTop,!1],alwaysRootAtBottom:[c.RootAtTop,!1],fCenter:c.FCenter,Axiom:c.AxiomF,UnaryInf:[c.InferenceF,1],BinaryInf:[c.InferenceF,2],TrinaryInf:[c.InferenceF,3],QuaternaryInf:[c.InferenceF,4],QuinaryInf:[c.InferenceF,5]});new X("Bussproofs-environments",W.environment,{prooftree:[c.Prooftree,null,!1]});const me=Y.create("bussproofs",{[I.HANDLER]:{[F.MACRO]:["Bussproofs-macros"],[F.ENVIRONMENT]:["Bussproofs-environments"]},[I.ITEMS]:{[j.prototype.kind]:j},[I.PREPROCESSORS]:[[ae,1]],[I.POSTPROCESSORS]:[[de,3],[le,2],[se,1]]});export{me as BussproofsConfiguration};
