import{C as u,a as l,p as O,z as g,e as i,o as w,b as d,H as k,t as m,q as p,B as P,j as b}from"./index-qNrukWGA.js";import"./index-DkSxGWYw.js";const f={filterPackage(e,o){if(o!=="tex"&&!w.get(o))throw new i("NotAPackage","Not a defined package: %1",o);const t=e.options.setoptions,a=t.allowOptions[o];if(a===void 0&&!t.allowPackageDefault||a===!1)throw new i("PackageNotSettable",`Options can't be set for package "%1"`,o);return!0},filterOption(e,o,t){const a=e.options.setoptions,n=a.allowOptions[o]||{},s=o==="tex",r=Object.hasOwn(n,t)&&!g(n[t])?n[t]:null;if(r===!1||r===null&&!a.allowOptionsDefault)throw s?new i("TeXOptionNotSettable",'Option "%1" is not allowed to be set',t):new i("OptionNotSettable",'Option "%1" is not allowed to be set for package %2',t,o);const c=s?e.options:e.options[o];if(!c||!Object.hasOwn(c,t))throw s?new i("InvalidTexOption",'Invalid TeX option "%1"',t):new i("InvalidOptionKey",'Invalid option "%1" for package "%2"',t,o);return!0},filterValue(e,o,t,a){if(typeof a!="string")return a;const n=a.match(/^\/(.*)\/([dgimsuvy]*)$/);return n?new RegExp(n[1],n[2]):a}};function h(e,o){const t=e.GetBrackets(o)||"tex",a=b.keyvalOptions(e.GetArgument(o)),n=e.options.setoptions;if(n.filterPackage(e,t)){for(const s of Object.keys(a))n.filterOption(e,t,s)&&((t==="tex"?e.options:e.options[t])[s]=n.filterValue(e,t,s,a[s]));e.Push(e.itemFactory.create("null"))}}function T(e,o){const t=new d("setoptions",{setOptions:h}),a=o.parseOptions.handlers.get(k.MACRO);a.add(["setoptions"],null,m.DEFAULTPRIORITY-1);const n=a.lookup("require");n&&(t.add("Require",new p("Require",n._func)),t.add("require",new p("require",P.Macro,["\\Require{#2}\\setOptions[#2]{#1}",2,""])))}const q=u.create("setoptions",{[l.CONFIG]:T,[l.PRIORITY]:3,[l.OPTIONS]:{setoptions:{filterPackage:f.filterPackage,filterOption:f.filterOption,filterValue:f.filterValue,allowPackageDefault:!0,allowOptionsDefault:!0,allowOptions:O({tex:{FindTeX:!1,formatError:!1,package:!1,baseURL:!1,tags:!1,maxBuffer:!1,maxMaxros:!1,macros:!1,environments:!1},setoptions:!1,autoload:!1,require:!1,configmacros:!1,tagformat:!1})}}});export{q as SetOptionsConfiguration,f as SetOptionsUtil};
